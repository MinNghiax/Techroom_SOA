<div class="manage-rooms-container">
  <header class="page-header">
    <div class="header-text">
      <h1>Quản lý phòng trọ</h1>
      <p>Cập nhật thông tin, giá cả và trạng thái thuê phòng</p>
    </div>
    <button class="btn-primary" (click)="openAddModal()">+ Thêm phòng mới</button>
  </header>

  <main class="content-area">
    @if (isLoading) {
      <div class="loading-box">Đang đồng bộ danh sách phòng...</div>
    } @else {
      <div class="table-wrapper">
        <table class="room-table">
          <thead>
            <tr>
              <th>Tên phòng & Tòa nhà</th>
              <th>Diện tích</th>
              <th>Giá thuê</th>
              <th>Trạng thái</th>
              <th class="text-right">Thao tác</th>
            </tr>
          </thead>
          <tbody>
            @for (room of rooms; track room.id) {
              <tr>
                <td>
                  <div class="room-info">
                    <span class="room-name">{{ room.name }}</span>
                    <span class="b-name">{{ room.buildingName }}</span>
                  </div>
                </td>
                <td><span class="area-text">{{ room.area }} m²</span></td>
                <td><span class="price-text">{{ room.price | currency:'VND':'symbol':'1.0-0' }}</span></td>
                <td>
                  <span class="status-pill" [ngClass]="room.status.toLowerCase()">
                    {{ getStatusLabel(room.status) }}
                  </span>
                </td>
                <td class="text-right">
                  <div class="action-group">
                    <button class="link-btn" (click)="openEditModal(room)">Chỉnh sửa</button>
                    <button class="link-btn danger" (click)="deleteRoom(room.id)">Xóa</button>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>

        @if (rooms.length === 0) {
          <div class="empty-msg">Bạn chưa đăng tải phòng nào.</div>
        }
      </div>
    }
  </main>

  @if (isModalOpen) {
    <div class="modal-overlay">
      <div class="modal-card">
        <div class="modal-header">
          <h2>{{ isEditMode ? 'Cập nhật phòng' : 'Thêm phòng mới' }}</h2>
          <button class="btn-close" (click)="isModalOpen = false">Đóng</button>
        </div>
        
        <div class="modal-body">
          <div class="form-row">
            <div class="form-group">
              <label>Tên phòng</label>
              <input type="text" [(ngModel)]="roomForm.name" placeholder="Ví dụ: P.402">
            </div>
            <div class="form-group">
              <label>Tòa nhà (ID)</label>
              <input type="number" [(ngModel)]="roomForm.buildingId">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Giá thuê (VNĐ)</label>
              <input type="number" [(ngModel)]="roomForm.price">
            </div>
            <div class="form-group">
              <label>Diện tích (m²)</label>
              <input type="number" [(ngModel)]="roomForm.area">
            </div>
          </div>

          <div class="form-group">
            <label>Trạng thái</label>
            <select [(ngModel)]="roomForm.status">
              <option value="AVAILABLE">Còn trống</option>
              <option value="OCCUPIED">Đã thuê</option>
              <option value="REPAIRING">Đang sửa chữa</option>
            </select>
          </div>

          <div class="form-group">
            <label>Mô tả chi tiết</label>
            <textarea [(ngModel)]="roomForm.description" rows="3"></textarea>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn-secondary" (click)="isModalOpen = false">Hủy bỏ</button>
          <button class="btn-save" (click)="saveRoom()">Lưu thông tin</button>
        </div>
      </div>
    </div>
  }
</div>