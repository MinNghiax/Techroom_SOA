<div class="contract-container">
  <div class="header-section">
    <h2>Quản lý Hợp đồng & Yêu cầu</h2>
    <button class="btn-create" *ngIf="userRole === 'LANDLORD'">+ Tạo hợp đồng mới</button>
  </div>

  <div *ngIf="isLoading" class="loading-text">Đang tải dữ liệu...</div>

  <table class="contract-table" *ngIf="!isLoading">
    <thead>
      <tr>
        <th>Mã HĐ</th>
        <th>Khách thuê</th>
        <th>Tiền thuê</th>
        <th>Ngày bắt đầu</th>
        <th>Trạng thái</th>
        <th>Thao tác</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of contracts">
        <td>{{ item.contractCode || '#' + item.id }}</td>
        <td>{{ item.fullName }}</td>
        <td>{{ item.monthlyRent | number }}đ</td>
        <td>{{ item.startDate | date:'dd/MM/yyyy' }}</td>
        <td>
          <span [ngClass]="{
            'badge-pending': item.status === 'PENDING',
            'badge-active': item.status === 'APPROVED' || item.status === 'ACTIVE',
            'badge-rejected': item.status === 'REJECTED' || item.status === 'CANCELLED'
          }" class="badge">
            {{ item.status }}
          </span>
        </td>
        <td class="action-buttons">
          <ng-container *ngIf="item.status === 'PENDING'">
            <button class="btn-approve" (click)="approve(item.id)">Duyệt</button>
            <button class="btn-reject" (click)="reject(item.id)">Từ chối</button>
          </ng-container>

          <ng-container *ngIf="item.status !== 'PENDING'">
            <button class="btn-detail" (click)="viewDetail(item.id)">Chi tiết</button>
            <button class="btn-danger" (click)="terminateContract(item.id)" *ngIf="item.status === 'ACTIVE'">Kết thúc</button>
          </ng-container>
        </td>
      </tr>
      <tr *ngIf="contracts.length === 0">
        <td colspan="6" style="text-align: center; padding: 20px;">Không có dữ liệu hợp đồng.</td>
      </tr>
    </tbody>
  </table>
  <div class="modal-overlay" *ngIf="showDetailModal" (click)="closeDetailModal()">
  <div class="modal-content detail-card" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Chi tiết Hợp đồng: {{ selectedContract?.contractCode }}</h3>
      <button class="close-x" (click)="closeDetailModal()">&times;</button>
    </div>

    <div class="modal-body" *ngIf="selectedContract">
      <div class="info-grid">
        <div class="info-group">
          <label>Khách thuê:</label>
          <p>{{ selectedContract.fullName }}</p>
        </div>
        <div class="info-group">
          <label>Số điện thoại:</label>
          <p>{{ selectedContract.phone }}</p>
        </div>
        <div class="info-group">
          <label>Số CCCD:</label>
          <p>{{ selectedContract.cccd }}</p>
        </div>
        <div class="info-group">
          <label>Địa chỉ:</label>
          <p>{{ selectedContract.address }}</p>
        </div>
        <div class="info-group">
          <label>Ngày bắt đầu:</label>
          <p>{{ selectedContract.startDate | date:'dd/MM/yyyy' }}</p>
        </div>
        <div class="info-group">
          <label>Ngày kết thúc:</label>
          <p>{{ selectedContract.endDate | date:'dd/MM/yyyy' }}</p>
        </div>
        <div class="info-group">
          <label>Tiền thuê tháng:</label>
          <p class="text-primary">{{ selectedContract.monthlyRent | number }}đ</p>
        </div>
        <div class="info-group">
          <label>Tiền đặt cọc:</label>
          <p class="text-danger">{{ selectedContract.deposit | number }}đ</p>
        </div>
      </div>

      <div class="info-full">
        <label>Ghi chú khách hàng:</label>
        <div class="notes-box">
          {{ selectedContract.notes || 'Không có ghi chú.' }}
        </div>
      </div>

      <div class="info-full" *ngIf="selectedContract.rejectionReason">
        <label>Lý do từ chối:</label>
        <p class="text-danger">{{ selectedContract.rejectionReason }}</p>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeDetailModal()">Đóng</button>
    </div>
  </div>
</div>
</div>