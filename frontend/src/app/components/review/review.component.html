<div class="review-wrapper">
  <div class="write-review-card" [class.editing]="isEditing">
    <h3>{{ isEditing ? 'âœ Chá»‰nh sá»­a Ä‘Ã¡nh giÃ¡ cá»§a báº¡n' : 'Äá»ƒ láº¡i Ä‘Ã¡nh giÃ¡ cá»§a báº¡n' }}</h3>
    <div class="star-picker">
      <span *ngFor="let s of stars" (click)="setRating(s)" [class.active]="s <= newReview.rating">â˜…</span>
      <span class="rating-label">{{ newReview.rating }}/5 sao</span>
    </div>
    <textarea [(ngModel)]="newReview.comment" placeholder="Cáº£m nháº­n cá»§a báº¡n..."></textarea>
    <div class="actions">
      <button (click)="submitReview()" [disabled]="isSubmitting" class="btn-primary">
        {{ isEditing ? 'Cáº­p nháº­t' : 'Gá»­i Ä‘Ã¡nh giÃ¡' }}
      </button>
      <button *ngIf="isEditing" (click)="resetForm()" class="btn-cancel">Há»§y</button>
    </div>
  </div>

  <hr class="divider">

  <div class="review-list-section">
    <h3>ÄÃ¡nh giÃ¡ tá»« cá»™ng Ä‘á»“ng ({{ reviews.length }})</h3>
    <div class="review-item" *ngFor="let r of reviews">
      <div class="rev-header">
        <div class="user-info">
          <div class="avatar">{{ r.username?.charAt(0).toUpperCase() }}</div>
          <div>
            <div class="name">{{ r.username }}</div>
            <div class="date">{{ r.createdAt | date:'HH:mm dd/MM/yyyy' }}</div>
          </div>
        </div>
        
        <div class="rev-actions">
          <ng-container *ngIf="authService.isAuthenticated()">
            <div class="owner-actions" *ngIf="getCurrentUserId() === r.tenantId">
              <button (click)="onEdit(r)" class="text-edit">Sá»­a</button>
              <button (click)="onDelete(r.id)" class="text-delete">XÃ³a</button>
            </div>
            <button *ngIf="getCurrentUserId() !== r.tenantId" (click)="onReport(r.id)" class="btn-report">ğŸš© BÃ¡o cÃ¡o</button>
          </ng-container>

          <div class="rev-stars">
            <span class="filled" *ngFor="let s of getStarsArray(r.rating)">â˜…</span>
            <span *ngFor="let s of getStarsArray(5 - r.rating)">â˜…</span>
          </div>
        </div>
      </div>
      <p class="comment-text">{{ r.comment }}</p>
    </div>
  </div>
</div>